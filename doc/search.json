[
  {
    "objectID": "scripts/03_run_simulation.html#objective",
    "href": "scripts/03_run_simulation.html#objective",
    "title": "3  Simulation script",
    "section": "3.1 Objective",
    "text": "3.1 Objective\nIn this section, we will generate 2 following different missingness scenarios.\n\n# define column numbers for pattern and weight determination\ncol_Z2 &lt;- which(colnames(mock_cohort) %in% \"Z2\")\ncol_U &lt;- which(colnames(mock_cohort) %in% \"U\")\n\n# define missingness pattern\ndefault_pattern &lt;- rep(1, ncol(mock_cohort))\npattern &lt;- replace(default_pattern, col_Z2, 0)\n\n# define weights \ndefault_weights &lt;- rep(0, ncol(mock_cohort))\nweights &lt;- replace(default_weights, c(col_Z2, col_U), c(0.2, 0.8))\n\nprop &lt;- 0.5"
  },
  {
    "objectID": "scripts/03_run_simulation.html#continuous-distribution-probabilities",
    "href": "scripts/03_run_simulation.html#continuous-distribution-probabilities",
    "title": "3  Simulation script",
    "section": "3.2 Continuous distribution probabilities",
    "text": "3.2 Continuous distribution probabilities\nProbabilities are based on a continuous distribution.\n\ntic(msg = \"Simulation based on continuous distribution\")\n\nresults &lt;- parallel::mclapply(\n  X = 1:n_replicates,\n  FUN = run_simulation,\n  pattern = pattern,\n  weights = weights,\n  type = \"RIGHT\",\n  prop = prop,\n  mc.cores = parallel::detectCores()-1\n  ) \n  \nresults_cont &lt;- do.call(rbind, results) |&gt; \n  mutate(simulation = \"Continuous distribution (RIGHT)\")\n\ntoc()\n\nSimulation based on continuous distribution: 2.253 sec elapsed"
  },
  {
    "objectID": "scripts/03_run_simulation.html#discrete-distribution-probabilities",
    "href": "scripts/03_run_simulation.html#discrete-distribution-probabilities",
    "title": "3  Simulation script",
    "section": "3.3 Discrete distribution probabilities",
    "text": "3.3 Discrete distribution probabilities\nProbabilities are based on a discrete distribution.\n\ntic(msg = \"Simulation based on discrete distribution\")\n\nodds &lt;- c(1, 2, 3, 4)\n\nresults &lt;- parallel::mclapply(\n  X = 1:n_replicates,\n  FUN = run_simulation,\n  pattern = pattern,\n  weights = weights,\n  odds = odds,\n  prop = prop,\n  mc.cores = parallel::detectCores()-1\n  ) \n  \nresults_odds &lt;- do.call(rbind, results) |&gt; \n  mutate(simulation = paste0(\"Discrete odds (\", paste0(odds, collapse = \", \"), \")\"))\n\ntoc()\n\nSimulation based on discrete distribution: 2.14 sec elapsed"
  },
  {
    "objectID": "scripts/03_run_simulation.html#save-simulation-results",
    "href": "scripts/03_run_simulation.html#save-simulation-results",
    "title": "3  Simulation script",
    "section": "3.4 Save simulation results",
    "text": "3.4 Save simulation results\n\nresults &lt;- rbind(results_cont, results_odds) |&gt; \n  mutate(method = factor(method, levels = c(\n    \"Unadjusted\", \n    \"Complete case\", \n    \"Imputed\"))\n    )"
  },
  {
    "objectID": "scripts/03_run_simulation.html#results",
    "href": "scripts/03_run_simulation.html#results",
    "title": "3  Simulation script",
    "section": "3.5 Results",
    "text": "3.5 Results\nThe next steps of this script analyze the raw simulation results obtained in the previous script via run_simulation.R. The last run on 2024-10-14 20:15:57.284436."
  },
  {
    "objectID": "scripts/03_run_simulation.html#read-raw-results-table",
    "href": "scripts/03_run_simulation.html#read-raw-results-table",
    "title": "3  Simulation script",
    "section": "3.6 Read raw results table",
    "text": "3.6 Read raw results table\nWe first look at the results table with the raw simulation results.\n\nresults |&gt; \n  glimpse()\n\nRows: 12\nColumns: 5\n$ method     &lt;fct&gt; Unadjusted, Complete case, Imputed, Unadjusted, Complete ca…\n$ estimate   &lt;dbl&gt; 1.2629630, 0.8932111, 0.9111699, 1.1150121, 0.8824297, 1.03…\n$ se         &lt;dbl&gt; 0.07923421, 0.13274238, 0.10924959, 0.07479571, 0.11677905,…\n$ replicate  &lt;int&gt; 1, 1, 1, 2, 2, 2, 1, 1, 1, 2, 2, 2\n$ simulation &lt;chr&gt; \"Continuous distribution (RIGHT)\", \"Continuous distribution…"
  },
  {
    "objectID": "scripts/03_run_simulation.html#qc",
    "href": "scripts/03_run_simulation.html#qc",
    "title": "3  Simulation script",
    "section": "3.7 QC",
    "text": "3.7 QC\nLet’s do a few quality/sanity checks.\n\nNumber of analysis methods\n\n\nunique(results$method)\n\n[1] Unadjusted    Complete case Imputed      \nLevels: Unadjusted Complete case Imputed\n\n\n\nAssert that there are no missing results\n\n\nassert_that(!any(sapply(results$estimate, is.na)), msg = \"There are missing estimates\")\n\n[1] TRUE\n\nassert_that(!any(sapply(results$se, is.na)), msg = \"There are missing standard errors\")\n\n[1] TRUE"
  },
  {
    "objectID": "scripts/03_run_simulation.html#main-results",
    "href": "scripts/03_run_simulation.html#main-results",
    "title": "3  Simulation script",
    "section": "3.8 Main results",
    "text": "3.8 Main results\n\n# call helper functions\nsource(here::here(\"functions\", \"rsimsum_ggplot.R\"))\n\nFor the analysis of aggregate simulation results we use the rsimsum package. More information about this package can be found here.[@rsimsum]\n\nsimsum_out &lt;- simsum(\n  data = results, \n  estvarname = \"estimate\", \n  se = \"se\", \n  true = 1, \n  by = \"simulation\",\n  methodvar = \"method\", \n  ref = \"Complete case\"\n  ) |&gt; \n  summary() |&gt; \n  tidy()\n\n\nHazard ratio distributionHazard ratio distribution (interactive)\n\n\n\nhr_distribution &lt;- results |&gt; \n  ggplot(aes(x = method, y = estimate)) +\n  geom_boxplot(outlier.colour = \"red\") +\n  geom_point(position = position_jitter(seed = 42), alpha = 0.15) +\n  geom_hline(yintercept = 1.0, color = \"forestgreen\", linetype = \"dashed\") +\n  labs(\n    x = \"Method\",\n    y = \"Hazard ratio (HR)\"\n    ) +\n  theme_bw() +\n  theme(\n    axis.title.x = element_blank(),\n    axis.text.x = element_text(angle = 35, vjust = 1, hjust=1)\n    ) +\n  facet_wrap(~simulation)\n\nhr_distribution\n\n\n\n\nFigure 3.1: Hazard ratio distribution by method across all simulated datasets.\n\n\n\n\n\n\n\nggplotly(hr_distribution)\n\n\n\n\n\n\n\n\n\n3.8.1 Root mean squared error (RMSE)\n\nrmse &lt;- rsimsum_ggplot(tidy_simsum = simsum_out, metric = \"rmse\")\n\nWarning: There were 2 warnings in `dplyr::mutate()`.\nThe first warning was:\nℹ In argument: `lower = sqrt(lower)`.\nℹ In group 1: `simulation = \"Continuous distribution (RIGHT)\"`.\nCaused by warning in `sqrt()`:\n! NaNs produced\nℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.\n\n\n\nPlotTable\n\n\n\nrmse$plot\n\n\n\n\nFigure 3.2: Root mean squared error by method.\n\n\n\n\n\n\n\nrmse$table |&gt; \n  gt()\n\n\n\n\n\nTable 3.1:  Root mean squared error by method. \n  \n    \n      method\n      est\n      lower\n      upper\n    \n  \n  \n    \n      Continuous distribution (RIGHT)\n    \n    Unadjusted\n0.203\nNaN\n0.310\n    Complete case\n0.112\n0.101\n0.122\n    Imputed\n0.067\nNaN\n0.106\n    \n      Discrete odds (1, 2, 3, 4)\n    \n    Unadjusted\n0.203\nNaN\n0.310\n    Complete case\n0.138\n0.104\n0.165\n    Imputed\n0.072\n0.055\n0.085\n  \n  \n  \n\n\n\n\n\n\n\n\n\n\n3.8.2 Bias\n\nbias &lt;- rsimsum_ggplot(tidy_simsum = simsum_out, metric = \"bias\")\n\n\nPlotTable\n\n\n\nbias$plot\n\n\n\n\nFigure 3.3: Bias by method.\n\n\n\n\n\n\n\nbias$table |&gt; \n  gt()\n\n\n\n\n\nTable 3.2:  Bias by method. \n  \n    \n      method\n      est\n      lower\n      upper\n    \n  \n  \n    \n      Continuous distribution (RIGHT)\n    \n    Unadjusted\n0.189\n0.044\n0.334\n    Complete case\n-0.112\n-0.123\n-0.102\n    Imputed\n-0.028\n-0.148\n0.092\n    \n      Discrete odds (1, 2, 3, 4)\n    \n    Unadjusted\n0.189\n0.044\n0.334\n    Complete case\n-0.015\n-0.284\n0.254\n    Imputed\n-0.071\n-0.086\n-0.056\n  \n  \n  \n\n\n\n\n\n\n\n\n\n\n3.8.3 Coverage\n\ncoverage &lt;- rsimsum_ggplot(tidy_simsum = simsum_out, metric = \"coverage\")\n\n\nPlotTable\n\n\n\ncoverage$plot\n\n\n\n\nFigure 3.4: Coverage by method.\n\n\n\n\n\n\n\ncoverage$table |&gt; \n  gt()\n\n\n\n\n\nTable 3.3:  Coverage by method. \n  \n    \n      method\n      est\n      lower\n      upper\n    \n  \n  \n    \n      Continuous distribution (RIGHT)\n    \n    Unadjusted\n0.5\n-0.193\n1.193\n    Complete case\n1.0\n1.000\n1.000\n    Imputed\n1.0\n1.000\n1.000\n    \n      Discrete odds (1, 2, 3, 4)\n    \n    Unadjusted\n0.5\n-0.193\n1.193\n    Complete case\n1.0\n1.000\n1.000\n    Imputed\n1.0\n1.000\n1.000\n  \n  \n  \n\n\n\n\n\n\n\n\n\n\n3.8.4 Empirical standard error\n\nempse &lt;- rsimsum_ggplot(tidy_simsum = simsum_out, metric = \"empse\")\n\n\nPlotTable\n\n\n\nempse$plot\n\n\n\n\nFigure 3.5: Empirical standard error by method.\n\n\n\n\n\n\n\nempse$table |&gt; \n  gt()\n\n\n\n\n\nTable 3.4:  Empirical standard error by method. \n  \n    \n      method\n      est\n      lower\n      upper\n    \n  \n  \n    \n      Continuous distribution (RIGHT)\n    \n    Unadjusted\n0.105\n-0.040\n0.250\n    Complete case\n0.008\n-0.003\n0.018\n    Imputed\n0.087\n-0.033\n0.207\n    \n      Discrete odds (1, 2, 3, 4)\n    \n    Unadjusted\n0.105\n-0.040\n0.250\n    Complete case\n0.194\n-0.075\n0.463\n    Imputed\n0.011\n-0.004\n0.026"
  },
  {
    "objectID": "scripts/03_run_simulation.html#session-info",
    "href": "scripts/03_run_simulation.html#session-info",
    "title": "3  Simulation script",
    "section": "3.9 Session info",
    "text": "3.9 Session info\nTotal script runtime: 0.09 minutes.\n\nLoaded packagesSession infoRepositories\n\n\n\npander::pander(subset(data.frame(sessioninfo::package_info()), attached==TRUE, c(package, loadedversion)))\n\n\n\n\n\n\n\n\n\n \npackage\nloadedversion\n\n\n\n\nassertthat\nassertthat\n0.2.1\n\n\ndplyr\ndplyr\n1.1.4\n\n\nggplot2\nggplot2\n3.4.4\n\n\ngt\ngt\n0.10.1\n\n\nhere\nhere\n1.0.1\n\n\nplotly\nplotly\n4.10.4\n\n\nrsimsum\nrsimsum\n0.11.3\n\n\ntictoc\ntictoc\n1.2\n\n\ntidyr\ntidyr\n1.3.1\n\n\n\n\n\n\n\n\npander::pander(sessionInfo())\n\nR version 4.4.0 (2024-04-24)\nPlatform: aarch64-apple-darwin20\nlocale: en_US.UTF-8||en_US.UTF-8||en_US.UTF-8||C||en_US.UTF-8||en_US.UTF-8\nattached base packages: parallel, stats, graphics, grDevices, datasets, utils, methods and base\nother attached packages: plotly(v.4.10.4), tidyr(v.1.3.1), assertthat(v.0.2.1), rsimsum(v.0.11.3), gt(v.0.10.1), ggplot2(v.3.4.4), tictoc(v.1.2), dplyr(v.1.1.4) and here(v.1.0.1)\nloaded via a namespace (and not attached): sass(v.0.4.8), utf8(v.1.2.4), generics(v.0.1.3), renv(v.1.0.3), xml2(v.1.3.6), digest(v.0.6.33), magrittr(v.2.0.3), evaluate(v.0.23), grid(v.4.4.0), fastmap(v.1.1.1), rprojroot(v.2.0.4), jsonlite(v.1.8.8), sessioninfo(v.1.2.2), backports(v.1.4.1), httr(v.1.4.7), pander(v.0.6.5), purrr(v.1.0.2), fansi(v.1.0.6), crosstalk(v.1.2.1), viridisLite(v.0.4.2), scales(v.1.3.0), lazyeval(v.0.2.2), cli(v.3.6.2), rlang(v.1.1.2), ellipsis(v.0.3.2), munsell(v.0.5.0), withr(v.3.0.0), yaml(v.2.3.8), tools(v.4.4.0), checkmate(v.2.3.1), colorspace(v.2.1-0), vctrs(v.0.6.5), R6(v.2.5.1), ggridges(v.0.5.6), lifecycle(v.1.0.4), htmlwidgets(v.1.6.4), simsurv(v.1.0.0), pkgconfig(v.2.0.3), pillar(v.1.9.0), gtable(v.0.3.4), Rcpp(v.1.0.12), glue(v.1.6.2), data.table(v.1.15.0), xfun(v.0.41), tibble(v.3.2.1), tidyselect(v.1.2.0), knitr(v.1.45), farver(v.2.1.1), htmltools(v.0.5.7), rmarkdown(v.2.25), labeling(v.0.4.3) and compiler(v.4.4.0)\n\n\n\n\n\npander::pander(options('repos'))\n\n\nrepos:\n\n\n\n\n\n\nREPO_NAME\n\n\n\n\nhttps://packagemanager.posit.co/cran/latest"
  }
]